Спринт 2: Надёжность BBP

* Добавить таймауты и 1–2 ретрая в generatePairingsWithBBP , расширить диагностические логи и возврат причины. `bbp.ts` `generatePairingsWithBBP`

* Валидировать конфигурацию BBP\_PAIRINGS\_BIN , выдавать понятное сообщение при некорректной настройке.

* (Опционально, под флагом) включить простой Swiss для дев-режима/диагностики. `db.ts` `simpleSwissPairings`

* Критерии: 502 возвращается только при реальном падении/пустом результате; ретраи не нарушают идемпотентность.

Спринт 3: БД и производительность

* Добавить индексы по частым FK: rounds(tournament\_id) , matches(round\_id) , tournament\_participants(tournament\_id) , leaderboard(tournament\_id) . `supabase-full-migration.sql`

* Ввести уникальное ограничение tournament\_participants(tournament\_id, nickname) для защиты от дублей.

* Пересмотреть стоимостные запросы (standings, матчи) на батчирование и минимум round-trip.

* Критерии: отсутствие full scan, снижение p95 времени ответа.

Спринт 4: Интеграции и UX

* Реализовать неблокирующую отправку изображения standings в Telegram из генератора пар; обработать исключения. `route.tsx`

* Добавить кэш для Google Calendar и graceful degradation при квотах/ошибках; расширить метрики. `route.ts` `client.ts` `parser.ts`

* Критерии: изображение публикуется при успешной генерации; календарь стабилен и быстро отвечает.

Спринт 5: Тесты и CI

* Unit: валидация Telegram initData , BBP-интеграция, парсер календаря.

* Integration/e2e: негативные кейсы BBP (таймаут/недоступность), авторизация participants POST , отправка изображения; дополнить Playwright. `bbp-502.spec.ts`

* CI: конфиг многоплатформенный (Linux/macOS) с моками BBP и стабильными прогоном.

* Критерии: покрытие ключевых модулей ≥80%; стабильные прогоны без флаки.

