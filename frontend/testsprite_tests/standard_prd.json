{
  "meta": {
    "project": "RepChess - Telegram Integrated Chess Tournament Manager",
    "date": "2025-10-17",
    "prepared_by": "Generated by ChatGPT"
  },
  "product_overview": "RepChess is a chess tournament management web application integrated with Telegram, enabling users to participate in and manage chess tournaments seamlessly via a Telegram bot and a Next.js web app. It offers tournament creation, participant management, round pairing via BBP Pairings (Swiss variants: Dutch or Burstein) in BBP-only mode (no built-in Swiss fallback), results submission, and final leaderboard generation, all within a chess-themed user interface.",
  "core_goals": [
    "Enable seamless chess tournament management accessible via Telegram and web.",
    "Provide secure Telegram Web App authentication and admin authorization.",
    "Allow creation, archiving, and deletion of chess tournaments with flexible formats and scoring rules.",
    "Support participant registration and management within tournaments.",
    "Implement advanced round pairing algorithms compliant with Swiss-system rules via BBP Pairings integration (Dutch/Burstein).",
    "Enable input and update of match results securely authenticated through Telegram.",
    "Display real-time standings and leaderboards with finalization capability.",
    "Integrate with Google Calendar for importing and displaying upcoming tournaments.",
    "Offer intuitive admin UI for managing tournaments, rounds, participants, and results.",
    "Maintain a chess-themed, responsive, and accessible user interface with animated backgrounds."
  ],
  "key_features": [
    "Telegram Web App authentication with admin role validation and dev fallback.",
    "Supabase backend with Postgres database and in-memory fallback for local dev.",
    "Typed database access layer for users, tournaments, participants, rounds, matches, standings, and leaderboards.",
    "API endpoints for user search, tournament CRUD, participant management, round and pairings management, match result updates, and leaderboard retrieval.",
    "Admin UI for tournament creation, editing, participant addition, round creation, pairing generation, and result entry.",
    "Swiss-system pairing algorithm using BBP Pairings (Dutch/Burstein) in BBP-only mode (no built-in Swiss fallback). When BBP is unavailable or returns an empty result, a 502-specific message is shown to the user with guidance to diagnose and retry.",
    "Automatic tournament finalization when planned rounds are completed, with leaderboard snapshot and archiving.",
    "Google Calendar integration to fetch and display upcoming tournaments as events.",
    "Chess-themed UI with animated backgrounds, responsive design, and Framer Motion animations.",
    "Comprehensive E2E testing via Playwright and Testsprite to ensure stability and correctness."
  ],
  "user_flow_summary": [
    "User authenticates via Telegram Web App; dev environment offers fallback authentication.",
    "From the main page, user navigates to tournament list sourced from Google Calendar or their created tournaments.",
    "Admins access the admin panel to create new tournaments, specifying format, scoring, rounds, and tiebreakers.",
    "Admins add participants by searching usernames and assigning them to tournaments.",
    "Admins create rounds (tours) and generate pairings using the BBP Pairings engine (Dutch/Burstein) only. If BBP is unavailable, the UI presents a 502-specific diagnostic message and the admin can retry later from the tour page.",
    "Match results are entered by authenticated users on match detail pages, updating standings in real-time.",
    "When all rounds are completed, tournaments are finalized automatically or manually, archiving results and creating leaderboard snapshots.",
    "Users view personal profiles with chess ratings integrated from FIDE, Chess.com, and Lichess.",
    "The Telegram bot offers commands such as /start and /profile that link to the web application for seamless user experience."
  ],
  "validation_criteria": [
    "Telegram Web App authentication must validate initData with HMAC signature in production and fallback in development.",
    "Admin routes and actions require role verification against database or environment variables.",
    "Tournament creation API enforces required fields and admin authorization.",
    "Participant addition validates user existence and tournament association correctness.",
    "Pairings generation produces valid Swiss (BBP Pairings: Dutch/Burstein) pairings without repeat byes or illegal matches; BBP-only behavior requires that on BBP failure/unavailability, the system surfaces a 502-specific message and does not generate fallback pairings.",
    "Match result updates verify user authentication and update scores in the database correctly.",
    "Google Calendar events are parsed and displayed accurately with correct filtering of upcoming tournaments.",
    "UI elements adhere to the chess theme, responsive design, and accessibility standards.",
    "All critical flows have passing end-to-end tests covering happy paths and edge cases.",
    "Automatic tournament finalization triggers correctly when planned rounds are completed, with archived leaderboard snapshots stored reliably."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js (App Router, v15, Turbopack)",
      "Supabase (Postgres) with in-memory fallback",
      "Playwright & Testsprite for E2E",
      "Node.js",
      "PostCSS/CSS"
    ],
    "features": [
      {
        "name": "Telegram Web App Authentication & Admin",
        "description": "Parses and validates Telegram initData; provides dev fallback; checks admin via DB or env and guards admin routes.",
        "files": [
          "lib/telegram.ts",
          "hooks/useTelegramWebApp.ts",
          "app/admin/tournaments/new/page.tsx"
        ]
      },
      {
        "name": "Supabase Client Initialization & In-Memory Fallback",
        "description": "Initializes Supabase with required envs; when missing, uses in-memory MemStore/QueryBuilder to emulate basic CRUD and filters.",
        "files": [
          "lib/supabase.ts"
        ]
      },
      {
        "name": "Database Access Layer (Users/Tournaments/Rounds/Matches)",
        "description": "Typed interfaces and async data functions: users, tournaments, participants, rounds, matches, standings, leaderboard, finalization.",
        "files": [
          "lib/db.ts"
        ]
      },
      {
        "name": "Users API",
        "description": "Endpoints to list users and search by username fragment.",
        "files": [
          "app/api/users/route.ts",
          "app/api/users/search/route.ts"
        ]
      },
      {
        "name": "Tournaments API (create/list)",
        "description": "Create tournaments (admin required) and list existing tournaments.",
        "files": [
          "app/api/tournaments/route.ts"
        ]
      },
      {
        "name": "Tournaments: Calendar & Mine",
        "description": "Calendar feed and tournaments created by current user.",
        "files": [
          "app/api/tournaments/calendar/route.ts",
          "app/api/tournaments/mine/route.ts"
        ]
      },
      {
        "name": "Tournament Detail API ([id])",
        "description": "Get, archive/unarchive, and delete tournament (admin).",
        "files": [
          "app/api/tournaments/[id]/route.ts"
        ]
      },
      {
        "name": "Participants API",
        "description": "List and add participants to a tournament.",
        "files": [
          "app/api/tournaments/[id]/participants/route.ts"
        ]
      },
      {
        "name": "Rounds (Tours) API",
        "description": "List, create, and delete rounds with admin checks and limits.",
        "files": [
          "app/api/tournaments/[id]/tours/route.ts"
        ]
      },
      {
        "name": "Pairings Generation (BBP-only)",
        "description": "Generate pairings via BBP Pairings (Dutch/Burstein) in BBP-only mode (no built-in fallback); produce standings screenshot and send to Telegram; finalize if exceeded.",
        "files": [
          "lib/bbp.ts",
          "app/api/tournaments/[id]/tours/[tourId]/pairings/route.tsx"
        ]
      },
      {
        "name": "Matches API",
        "description": "List matches for a round and update results (requires Telegram user auth).",
        "files": [
          "app/api/tournaments/[id]/tours/[tourId]/matches/route.ts"
        ]
      },
      {
        "name": "Google Calendar Integration",
        "description": "Calendar utilities and API feed for upcoming tournaments.",
        "files": [
          "lib/google-calendar",
          "app/api/tournaments/calendar/route.ts"
        ]
      },
      {
        "name": "Admin UI for Tournament Management",
        "description": "Client-side form for creating tournaments and managing settings; stores draft in localStorage and submits with Telegram initData.",
        "files": [
          "app/admin/tournaments/new/page.tsx",
          "components/tournaments"
        ]
      },
      {
        "name": "Profile UI",
        "description": "User profile pages and utilities.",
        "files": [
          "app/profile",
          "lib/utils.ts"
        ]
      },
      {
        "name": "Core App Structure & Styling",
        "description": "Global layout, home page, chess-themed background and UI components.",
        "files": [
          "app/layout.tsx",
          "app/page.tsx",
          "components/ChessBackground.tsx",
          "components/ui"
        ]
      },
      {
        "name": "Testing & Tooling",
        "description": "Testsprite scenarios, Playwright config and E2E tests.",
        "files": [
          "testsprite_tests",
          "playwright.config.ts",
          "tests/e2e"
        ]
      },
      {
        "name": "Developer Scripts",
        "description": "Utility scripts and dev-only seeding endpoint.",
        "files": [
          "scripts/seed-users.js",
          "app/api/dev/seed-users/route.ts"
        ]
      }
    ]
  }
}
