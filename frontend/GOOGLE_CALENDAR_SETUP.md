# Настройка интеграции с Google Calendar

## Обзор

Приложение автоматически получает данные о турнирах из Google Calendar. События парсятся и отображаются на странице турниров.

## Инструкция по настройке

### Вариант 1: Публичный календарь с API ключом (Проще всего)

1. **Включите Google Calendar API**
   - Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
   - Создайте новый проект или выберите существующий
   - Включите "Google Calendar API"

2. **Создайте API ключ**
   - Перейдите в "APIs & Services" → "Credentials"
   - Нажмите "Create Credentials" → "API Key"
   - Скопируйте API ключ
   AIzaSyCF_JRX8SNj44hWNW8CtipxgsjNN4iuexQ

3. **Сделайте календарь публичным**
   - Откройте Google Calendar
   - Нажмите настройки (⚙️) → "Настройки моих календарей"
   - Выберите ваш календарь → "Права доступа"
   - Поставьте галочку "Сделать общедоступным"

4. **Получите ID календаря**
   - В настройках календаря → "Интеграция календаря"
   - Скопируйте "Идентификатор календаря" (выглядит как: `example@group.calendar.google.com`)

5. **Настройте переменные окружения**
   ```bash
   cd frontend
   cp .env.example .env.local
   ```
   Отредактируйте `.env.local`:
   ```
   GOOGLE_CALENDAR_ID=your-calendar-id@group.calendar.google.com
   GOOGLE_CALENDAR_API_KEY=your-api-key-here
   ```


### Вариант 2: Приватный календарь с сервисным аккаунтом (Рекомендуется)

1. **Включите Google Calendar API** (как в Варианте 1)

2. **Создайте сервисный аккаунт**
   - Перейдите в "IAM & Admin" → "Service Accounts"
   - Нажмите "Create Service Account"
   - Назовите его (например, "chess-tournament-bot")
   - Нажмите "Create and Continue"
   - Пропустите назначение роли (нажмите "Continue")
   - Нажмите "Done"

3. **Сгенерируйте ключ**
   - Кликните на созданный сервисный аккаунт
   - Перейдите на вкладку "Keys"
   - Нажмите "Add Key" → "Create new key"
   - Выберите формат "JSON"
   - Скачайте JSON файл

4. **Поделитесь календарем с сервисным аккаунтом**
   - Откройте Google Calendar
   - Нажмите настройки (⚙️) → "Настройки моих календарей"
   - Выберите ваш календарь → "Совместный доступ"
   - Нажмите "Добавить людей"
   - Введите email сервисного аккаунта (из JSON файла: `client_email`)
   - Установите права "Просмотр всех сведений о мероприятии"
   - Нажмите "Отправить"

5. **Настройте переменные окружения**
   ```bash
   cd frontend
   cp .env.example .env.local
   ```
   Отредактируйте `.env.local`:
   ```
   GOOGLE_CALENDAR_ID=your-calendar-id@group.calendar.google.com
   GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account","project_id":"..."}
   ```
   > **Важно**: Вставьте весь JSON контент как однострочную строку

## Формат событий

Создавайте события календаря с такой структурой для лучших результатов:

### Обязательные поля
- **Название**: Название турнира (например, "Блиц-турнир RepChess")
- **Время начала/окончания**: Дата и время события
- **Место**: Адрес площадки или "Онлайн"

### Необязательные поля
- **Описание**: Подробности о турнире
- **Расширенные свойства** (опционально):
  - Добавьте кастомное свойство `participants` с количеством участников
  - В Google Calendar API используйте `extendedProperties.private.participants`

### Пример события
```
Название: Блиц-турнир RepChess
Дата: 15 октября 2025
Время: 18:00 - 21:00
Место: Шахматный клуб на Невском, 25
Описание: Быстрые партии с контролем времени 5+3. Призовой фонд 50,000₽
```

## Тестирование

1. Запустите dev сервер:
   ```bash
   cd frontend
   npm run dev
   ```

2. Откройте [http://localhost:3000/tournaments](http://localhost:3000/tournaments)

3. Проверьте консоль браузера и логи сервера на наличие ошибок

## Решение проблем

### "Calendar credentials not configured"
- Убедитесь, что `.env.local` существует и содержит правильные переменные
- Перезапустите dev сервер после изменения `.env.local`

### "Failed to fetch tournaments"
- Проверьте, что ID календаря правильный
- Для публичного календаря: убедитесь, что он публичный
- Для сервисного аккаунта: убедитесь, что календарь расшарен с email сервисного аккаунта

### События не отображаются
- Убедитесь, что события существуют в календаре
- Проверьте, что события в будущем (прошедшие события фильтруются)
- Проверьте, что у события есть обязательные поля (название, время начала)

## Деплой

Для продакшена (Vercel):

1. Перейдите в настройки проекта → Environment Variables
2. Добавьте:
   - `GOOGLE_CALENDAR_ID`
   - `GOOGLE_CALENDAR_API_KEY` или `GOOGLE_SERVICE_ACCOUNT_KEY`
3. Передеплойте

## Безопасность

- **Никогда не коммитьте** `.env.local` или credentials в git
- Используйте сервисный аккаунт для продакшена (более безопасно)
- Ограничьте API ключ только Calendar API
- Регулярно меняйте ключи
